<!DOCTYPE html>
<html>
<head>
    <style>
        .title {
            color: white;
            text-align:center;
        }
        .sub-title{
            color: red;
            text-align:center;
        }
        .account{
            text-align:center;
        }
        .transaction{
            text-align:center;
        }
        .disabled{
            pointer-events: none;
            opacity: 0.4;
        }
    </style>
    <title>ATM</title>
</head>
<body style="background-color: black">
    <div class="title">
        <h1>ATM - Sistemas distribuidos</h1>
    </div>
    <div class="sub-title">
        <h2>Ingrese sus datos</h2>
    </div>
    <div class= "account" id="DivAccount" name="DivAccount">
        <label style="color:white">Cuenta</label><br>
        <input id="account" name="account" type="text" /> <br><br>
        <label style="color:white">Password</label><br>
        <input id="password" name="password" type="password" /> <br><br>        
    </div>    
    <div class="transaction" id="DivTransaction" name="DivTransaction">
        <label style="color:white">Retiro</label><br>
        <input id="withdraw" name="withdraw" type="text" /> <br>
        <button name="btnwithdraw" id="btnwithdraw">Retirar</button><br><br>
        <label style="color:white">consignación</label><br>
        <input id="consign" name="consign" type="text" /> <br>
        <button name="btnconsign" id="btnconsign">Consignar</button><br><br><br>
        <button name="btncheckBalance" id="btncheckBalance">Ver saldo</button><br><br>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io.connect('http://localhost:3000',{
            forceNew:true,
        });
        
        var botonRetirar = document.getElementById('btnwithdraw');
        var botonConsignar = document.getElementById('btnconsign');
        var botonSaldo = document.getElementById('btncheckBalance');        

        botonRetirar.addEventListener('click',function(e){
            e.preventDefault();
            var account = document.getElementById('account').value;
            var password = document.getElementById('password').value;
            var montoARetirar = document.getElementById('withdraw').value;
            socket.emit('withdraw', {account:account, password:password, montoARetirar:montoARetirar});
        });

        socket.on('withdraw', function(msg){
            if(msg === "ok"){
                alert("Aquí tiene su dinero");
            }else{
                alert("Fondos insuficientes, intente de nuevo");
            }
            socket.close();
            location.reload();
        });

        botonConsignar.addEventListener('click', function(e){
            e.preventDefault();
            var montoAconsignar = document.getElementById('consign').value;
            var account = document.getElementById('account').value;
            var password = document.getElementById('password').value;
            socket.emit('consign', {account:account, password:password, montoAconsignar:montoAconsignar});
        });

        socket.on('consign', function(msg){
            if(msg != "error"){
                alert("Consignación exitosa");
            }else{
                alert('Datos incorrectos!')
            }
            socket.close();
            location.reload();             
        });

        botonSaldo.addEventListener('click', function(e){
            e.preventDefault();
            var account = document.getElementById('account').value;
            var password = document.getElementById('password').value;
            socket.emit('check', {account:account, password:password});
        });

        socket.on('check',function(msg){
            if(msg != "error"){
                alert(`Su saldo es: ${msg}`);
            }else{
                alert('Datos incorrectos!')
            }
            socket.close();
            location.reload();        
        });
    </script>
</body>
</html>